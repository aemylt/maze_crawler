<!DOCTYPE html>
<html>
    <head>
        <title>Maze Navigation Demo</title>
        <meta charset="utf-8"/>
        <script type="text/javascript" src="http://fabricjs.com/lib/fabric.js"></script>
    </head>
    <body>
        <canvas id="maze" width="500" height="500" style="border:1px solid #ccc"></canvas>
        <script type="application/javascript">
            var maze_width = 500;
            var cell_width = 50;
            var cells_wide = 10;
            var maze = new fabric.Canvas('maze');
            maze.hoverCursor = 'default';
            maze.moveCursor = 'default';
            var cells = [];
            var obstacles = [[false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, true, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false]];
            var goal_x = 5;
            var goal_y = 9;
            for (i = 0; i < cells_wide; i = i + 1) {
                cells.push([]);
                for (j = 0; j < cells_wide; j = j + 1) {
                    var rect = new fabric.Rect({height:cell_width, width:cell_width, left:i * cell_width, top:j * cell_width});
                    if (obstacles[i][j]) {
                        rect.fill = 'grey';
                    } else if ((i === goal_x) && (j === goal_y)) {
                        rect.fill = 'green';
                    } else {
                        rect.fill = 'blue';
                    }
                    rect.hasControls = false;
                    rect.lockMovementX = true;
                    rect.lockMovementY = true;
                    rect.lockRotation = true;
                    rect.lockScalingFlip = true;
                    rect.lockScalingX = true;
                    rect.lockScalingY = true;
                    rect.lockUniScaling = true;
                    maze.add(rect);
                    cells[i].push(rect);
                }
            }

            var x = 1;
            var y = 2;
            var dir = 3
            var dirs = [0, 90, 180, 270];
            var nav = new fabric.Triangle({
                originX:'center', originY:'center', width: cell_width, height: cell_width, fill: 'red', left: x * cell_width + cell_width/2, top: y * cell_width + cell_width/2
            });
            nav.angle = dirs[dir];
            nav.hasControls = false;
            nav.lockMovementX = true;
            nav.lockMovementY = true;
            nav.lockRotation = true;
            nav.lockScalingFlip = true;
            nav.lockScalingX = true;
            nav.lockScalingY = true;
            nav.lockUniScaling = true;
            maze.add(nav);

            function turn(direction) {
                if (direction) {
                    dir = (dir + 1) % 4;
                } else if (dir > 0) {
                    dir = dir - 1;
                } else {
                    dir = 3;
                }
                maze.renderAll();
                nav.animate('angle', dirs[dir], {
                    onChange: maze.renderAll.bind(maze)
                });
            }

            turn(true);
        </script>
    </body>
</html>