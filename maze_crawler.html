<!DOCTYPE html>
<html>
    <head>
        <title>Maze Navigation Demo</title>
        <meta charset="utf-8"/>
        <script type="text/javascript" src="http://fabricjs.com/lib/fabric.js"></script>
    </head>
    <body>
        <canvas id="maze" width="500" height="500" style="border:1px solid #ccc"></canvas>
        <script type="application/javascript">
            var maze_width = 500;
            var cell_width = 50;
            var cells_wide = 10;
            var maze = new fabric.Canvas('maze');
            maze.hoverCursor = 'default';
            maze.moveCursor = 'default';
            var cells = [];
            var obstacles = [[false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, true, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false],
                            [false, false, false, false, false, false, false, false, false, false]];
            var goal_x = 5;
            var goal_y = 9;
            for (i = 0; i < cells_wide; i = i + 1) {
                cells.push([]);
                for (j = 0; j < cells_wide; j = j + 1) {
                    var rect = new fabric.Rect({height:cell_width, width:cell_width, left:i * cell_width, top:j * cell_width, hasControls:false, lockMovementX:true, lockMovementY:true, lockRotation:true, lockScalingFlip:true, lockScalingX:true, lockScalingY:true, lockUniScaling:true});
                    if (obstacles[i][j]) {
                        rect.fill = 'grey';
                    } else if ((i === goal_x) && (j === goal_y)) {
                        rect.fill = 'green';
                    } else {
                        rect.fill = 'blue';
                    }
                    maze.add(rect);
                    cells[i].push(rect);
                }
            }

            var x = 1;
            var y = 2;
            var dir = 0;
            var dirs = [0, 90, 180, 270];
            var nav = new fabric.Triangle({
                originX:'center', originY:'center', width: cell_width, height: cell_width, fill: 'red', left: x * cell_width + cell_width/2, top: y * cell_width + cell_width/2, angle:dirs[dir], hasControls:false, lockMovementX:true, lockMovementY:true, lockRotation:true, lockScalingFlip:true, lockScalingX:true, lockScalingY:true, lockUniScaling:true
            });
            maze.add(nav);
            var angles = [['+=0', '+=90', '+=180', '-=90'], ['-=90', '+=0', '+=90', '+=180'], ['+=180', '-=90', '+=0', '+=90'], ['+=90', '+=180', '-=90', '+=0']];

            var moves = [];

            function turn(direction) {
                moves.push(angles[dir][direction]);
                dir = direction;
            }

            function move() {
                if (moves.length === 0) {
                    return;
                }
                nav.animate('angle', moves.shift(), {
                    onChange: maze.renderAll.bind(maze),
                    onComplete: function() {
                        move(moves);
                    }
                });
            }

            turn(1);
            turn(0);
            turn(2);
            turn(0);
            turn(3);
            turn(0);
            turn(1);
            turn(2);
            turn(1);
            turn(3);
            turn(1);
            turn(2);
            turn(3);
            turn(2);

            move();
        </script>
    </body>
</html>